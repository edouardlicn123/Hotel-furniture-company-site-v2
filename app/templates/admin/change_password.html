{% extends "admin/base.html" %}

{% block title %}修改密码{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h3 class="h4 mb-0">修改密码</h3>
            <small>请确保新密码安全且不易被猜到</small>
        </div>

        <div class="card-body p-5">
            <!-- 這裡已經不需要再重複顯示閃現消息，因為 base.html 已處理 -->

            <!-- 修改密码表单 -->
            <form method="POST">
                <!-- 当前密码 -->
                <div class="mb-4">
                    <label for="old_password" class="form-label fw-bold fs-5">当前密码 <span class="text-danger">*</span></label>
                    <div class="input-group input-group-lg">
                        <input type="password" class="form-control" id="old_password" name="old_password" required>
                        <button class="btn btn-outline-secondary" type="button" id="toggleOldPassword">显示</button>
                    </div>
                </div>

                <!-- 新密码 -->
                <div class="mb-4">
                    <label for="new_password" class="form-label fw-bold fs-5">新密码 <span class="text-danger">*</span></label>
                    <div class="input-group input-group-lg">
                        <input type="password" class="form-control" id="new_password" name="new_password" required minlength="8">
                        <button class="btn btn-outline-secondary" type="button" id="toggleNewPassword">显示</button>
                    </div>
                    <div class="form-text mt-2 text-muted">
                        新密码至少 8 位字符，建议包含字母、数字和符号
                    </div>
                </div>

                <!-- 确认新密码 -->
                <div class="mb-5">
                    <label for="confirm_password" class="form-label fw-bold fs-5">确认新密码 <span class="text-danger">*</span></label>
                    <div class="input-group input-group-lg">
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required minlength="8">
                        <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">显示</button>
                    </div>
                </div>

                <!-- 按钮组 -->
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg px-5">确认修改密码</button>
                    <a href="{{ url_for('admin.main.index') }}" class="btn btn-outline-secondary btn-lg px-5 ms-3">取消</a>
                </div>
            </form>

            <!-- 安全提示 -->
            <div class="mt-5 text-center text-muted small">
                <strong>安全提示：</strong><br>
                修改密码后系统将自动登出，请使用新密码重新登录。<br>
                建议定期更换密码，并启用两步验证（如果您的邮箱支持）。
            </div>
        </div>

        <div class="card-footer bg-light text-muted text-center py-3">
            <small>密码修改后立即生效，旧密码将失效。</small>
        </div>
    </div>
</div>

<!-- JavaScript：密码显示/隐藏切换 -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    function togglePassword(inputId, buttonId) {
        const input = document.getElementById(inputId);
        const button = document.getElementById(buttonId);
        if (input && button) {
            button.addEventListener('click', function () {
                const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                input.setAttribute('type', type);
                this.textContent = type === 'password' ? '显示' : '隐藏';
            });
        }
    }

    togglePassword('old_password', 'toggleOldPassword');
    togglePassword('new_password', 'toggleNewPassword');
    togglePassword('confirm_password', 'toggleConfirmPassword');
});
</script>
{% endblock %}
